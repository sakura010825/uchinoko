rules_version = '2';

service firebase.storage {
  match /b/{bucket}/o {
        // 投稿画像のパス: posts/{userId}/{fileName}
        // 注意: 実際のパスは posts/{userId}/{fileName} ですが、
        // Storageのセキュリティルールでは posts/{userId}/{allFiles=**} のように
        // ワイルドカードを使用することも可能です
        match /posts/{userId}/{fileName} {
      // 認証必須: ログインしているユーザーのみ書き込み可能
      allow write: if request.auth != null 
                   && request.auth.uid == userId
                   && request.resource.size <= 5 * 1024 * 1024  // 5MB以下
                   && request.resource.contentType.matches('image/.*');
      
      // 認証済みユーザーは読み込み可能
      allow read: if request.auth != null;
      
      // 公開読み込みも許可（投稿一覧表示のため）
      allow read: if true;
    }
    
    // その他のパスはデフォルトで拒否
    match /{allPaths=**} {
      allow read, write: if false;
    }
  }
}

